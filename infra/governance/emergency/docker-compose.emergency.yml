version: '3.8'

services:
  monitor:
    build:
      context: .
      dockerfile: Dockerfile.monitor
    image: localhost:5000/idp/mcp-monitor:latest
    container_name: mcp-emergency-monitor
    ports:
      - "3099:3099"
    environment:
      - NODE_ENV=production
      - ALERT_MODE=EMERGENCY
      - SLACK_WEBHOOK=${SLACK_WEBHOOK:-}
      - EMAIL_ALERTS=${EMAIL_ALERTS:-}
    volumes:
      - /var/log:/logs:ro
      - ./alerts:/app/alerts
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3099/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
EOF < /dev/null
